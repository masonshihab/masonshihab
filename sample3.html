<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Data Science Sample 3</title>

<script src="site_libs/header-attrs-2.9/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/simplex.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Mason's GitHub</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="samples.html">Research Projects</a>
</li>
<li>
  <a href="resume.pdf">Resume</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Data Science Sample 3</h1>

</div>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Today we will be exploring mask wearing compliance and ways to cluster localities by this metric. We will also explore ways to predict it!</p>
</div>
<div id="compliance-by-county" class="section level1">
<h1>1 Compliance by County</h1>
<pre class="r"><code>map_data = counties %&gt;% left_join(mask_use_by_county, 
                                  by = c(&quot;county_fips&quot; = &quot;COUNTYFP&quot;)) %&gt;% 
  mutate(maskprob = NEVER*0 + RARELY*.2 + SOMETIMES*.35 + FREQUENTLY*.8 + ALWAYS)

#probability estimates from adjectives pulled from https://grammar.reverso.net/frequency/

map_data %&gt;%
  ggplot(aes(long, lat, group = group, fill = maskprob)) +
  geom_polygon(color = NA) +
  coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45)</code></pre>
<p><img src="sample3_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
</div>
<div id="chance-of-55-masked" class="section level1">
<h1>2 Chance of 5/5 masked</h1>
<pre class="r"><code>map_data %&gt;%
  ggplot(aes(long, lat, group = group, fill = maskprob^5)) +
  geom_polygon(color = NA) +
  coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45)</code></pre>
<p><img src="sample3_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="comparison-between-1-and-2" class="section level1">
<h1>3 Comparison between 1 and 2</h1>
<p>The approach from 2 better, because this gives you a better sense what your probability of being in a dangerous situation with multiple unmasked people is. It also gives you a better sense of transmission, as Covid spreads from multiple people not taking proper precautions. However, the approach from 1 can give you a better picture of differences between counties between the extremes of compliance versus non compliance. The approach from 2 tends to make counties with lower compliance even lower by a large amount.</p>
</div>
<div id="clustering-methods" class="section level1">
<h1>4 Clustering Methods</h1>
<pre class="r"><code>mask_use_nofip = mask_use_by_county %&gt;% 
  mutate(maskprob = NEVER*0 + RARELY*.2 + SOMETIMES*.35 + FREQUENTLY*.8 + ALWAYS) %&gt;% 
  select(maskprob)</code></pre>
<div id="single" class="section level2">
<h2>Single</h2>
<pre class="r"><code>hc.single = hclust(dist(mask_use_nofip), method=&quot;single&quot;)

mask_use_cluster_s = mask_use_nofip %&gt;% 
  mutate(cluster = cutree(hc.single, 2))

mask_use_cluster_s$COUNTYFP = mask_use_by_county$COUNTYFP

mask_use_cluster_s %&gt;% left_join(counties, by = c(&quot;COUNTYFP&quot; = &quot;county_fips&quot;)) %&gt;% 
  ggplot(aes(long, lat, group = group, fill = cluster)) +
  geom_polygon(color = NA) +
  coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45)</code></pre>
<p><img src="sample3_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="complete" class="section level2">
<h2>Complete</h2>
<pre class="r"><code>hc.complete = hclust(dist(mask_use_nofip), method=&quot;complete&quot;)

mask_use_cluster_c = mask_use_nofip %&gt;% 
  mutate(cluster = cutree(hc.complete, 2))

mask_use_cluster_c$COUNTYFP = mask_use_by_county$COUNTYFP

mask_use_cluster_c %&gt;% left_join(counties, by = c(&quot;COUNTYFP&quot; = &quot;county_fips&quot;)) %&gt;% 
  ggplot(aes(long, lat, group = group, fill = cluster)) +
  geom_polygon(color = NA) +
  coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45)</code></pre>
<p><img src="sample3_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="average" class="section level2">
<h2>Average</h2>
<pre class="r"><code>hc.average = hclust(dist(mask_use_nofip), method=&quot;average&quot;)

mask_use_cluster_a = mask_use_nofip %&gt;% 
  mutate(cluster = cutree(hc.average, 2))

mask_use_cluster_a$COUNTYFP = mask_use_by_county$COUNTYFP

mask_use_cluster_a %&gt;% left_join(counties, by = c(&quot;COUNTYFP&quot; = &quot;county_fips&quot;)) %&gt;% 
  ggplot(aes(long, lat, group = group, fill = cluster)) +
  geom_polygon(color = NA) +
  coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45)</code></pre>
<p><img src="sample3_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="k-means" class="section level2">
<h2>K Means</h2>
<pre class="r"><code>set.seed(1)
km.out=kmeans(mask_use_nofip,2,nstart=20)

mask_use_cluster_k = mask_use_nofip %&gt;% 
  mutate(cluster = km.out$cluster)

mask_use_cluster_k$COUNTYFP = mask_use_by_county$COUNTYFP

mask_use_cluster_k %&gt;% left_join(counties, by = c(&quot;COUNTYFP&quot; = &quot;county_fips&quot;)) %&gt;% 
  ggplot(aes(long, lat, group = group, fill = cluster)) +
  geom_polygon(color = NA) +
  coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45)</code></pre>
<p><img src="sample3_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>It appears the K Means clustering was the only type to generate something useful. The clusters are near each other in size, which makes for a more natural seeming cutoff. The cutoff point for the two clusters was 72% probability, which seems pretty good (if you don’t think about question 2). In this case, the higher compliance cluster came out as cluster 1.</p>
</div>
<div id="predicting-mask-usage" class="section level2">
<h2>5 Predicting Mask usage</h2>
<div id="pre-work-a-reloading-the-data." class="section level3">
<h3>Pre-work A: Reloading the data.</h3>
<pre class="r"><code>var &lt;- load_variables(2019, &quot;acs1&quot;, cache = TRUE)</code></pre>
<p>API Key hidden!</p>
</div>
<div id="pre-work-b-selecting-the-variable" class="section level3">
<h3>Pre-work B: Selecting the variable</h3>
<pre class="r"><code>census_data = get_acs(geography = &quot;county&quot;, variables = c(soc_sci = &quot;B15012_006&quot;, 
                                                           totalpop = &quot;B01003_001&quot;,
                                                           year = 2019))</code></pre>
<pre><code>## Getting data from the 2015-2019 5-year ACS</code></pre>
<pre><code>## Fetching data by table type (&quot;B/C&quot;, &quot;S&quot;, &quot;DP&quot;) and combining the result.</code></pre>
<p>I have chosen to reuse my Social Scientist Majors variable. This variable reveals the number of people who studied social sciences in college. Bringing in total population to report Social Science majors as a percentage.</p>
</div>
<div id="pre-work-c-creating-the-data-set." class="section level3">
<h3>Pre-work C: Creating the data set.</h3>
<pre class="r"><code>census_wider = census_data %&gt;% 
  pivot_wider(id_cols = c(NAME, GEOID), names_from = variable, values_from = estimate) %&gt;% 
  separate(NAME, into = c(&quot;county&quot;, &quot;state&quot;), sep = &quot;, &quot;) %&gt;% 
  arrange(state, county) %&gt;% mutate(pct_soc_sci = soc_sci/totalpop) 

map_data_asc = mask_use_by_county %&gt;% left_join(census_wider, 
                                                by = c(&quot;COUNTYFP&quot; = &quot;GEOID&quot;)) %&gt;% 
  mutate(maskprob = NEVER*0 + RARELY*.2 + SOMETIMES*.35 + FREQUENTLY*.8 + ALWAYS)</code></pre>
</div>
<div id="k-means-on-my-chosen-variable" class="section level3">
<h3>K Means on my Chosen Variable</h3>
<pre class="r"><code>set.seed(1)
km.out.acs=kmeans(select(map_data_asc, pct_soc_sci),2,nstart=20)

mask_use_cluster_k_acs = map_data_asc %&gt;% 
  mutate(cluster_sc = km.out.acs$cluster)


#plotting... looks similar to maskprob map
mask_use_cluster_k_acs %&gt;% left_join(counties, by = c(&quot;COUNTYFP&quot; = &quot;county_fips&quot;)) %&gt;% 
  ggplot(aes(long, lat, group = group, fill = cluster_sc)) +
  geom_polygon(color = NA) +
  coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45)</code></pre>
<p><img src="sample3_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>I decided to also do a KMeans cluster for my social scientist variable. Cluster number 2 indicates more social science majors. It looks somewhat like the K Means map for mask usage, which is a good sign.</p>
</div>
<div id="testtrain" class="section level3">
<h3>test/train</h3>
<pre class="r"><code>mask_use_cluster_k_acs$cluster_mask = mask_use_cluster_k$cluster

sample_data &lt;- sample.int(n = nrow(mask_use_cluster_k_acs), 
                          size = floor(.8*nrow(mask_use_cluster_k_acs)), replace = F)
train_data &lt;- mask_use_cluster_k_acs[sample_data,]
test_data  &lt;- mask_use_cluster_k_acs[-sample_data,]</code></pre>
<p>We will now predict what cluster number for mask wearing is predicted based on percentage of social scientists.</p>
</div>
<div id="tree" class="section level3">
<h3>tree</h3>
<pre class="r"><code>set.seed(1)
tree = rpart(cluster_mask ~ pct_soc_sci, data = mask_use_cluster_k_acs, method = &quot;class&quot;)

rpart.plot(tree, yesno = 2, type = 1)</code></pre>
<p><img src="sample3_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<pre class="r"><code>pred1 = predict(tree, test_data, type = &quot;class&quot;)</code></pre>
<p>I think we are going in the right direction… If your county has equal to or more than 1% social science majors, you have 79% chance of being in the higher compliance cluster!</p>
<pre class="r"><code>confusionMatrix(as.factor(as.numeric(pred1)), as.factor(test_data$cluster_mask))</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction   1   2
##          1 175  36
##          2 161 257
##                                           
##                Accuracy : 0.6868          
##                  95% CI : (0.6489, 0.7229)
##     No Information Rate : 0.5342          
##     P-Value [Acc &gt; NIR] : 4.617e-15       
##                                           
##                   Kappa : 0.3874          
##                                           
##  Mcnemar&#39;s Test P-Value : &lt; 2.2e-16       
##                                           
##             Sensitivity : 0.5208          
##             Specificity : 0.8771          
##          Pos Pred Value : 0.8294          
##          Neg Pred Value : 0.6148          
##              Prevalence : 0.5342          
##          Detection Rate : 0.2782          
##    Detection Prevalence : 0.3355          
##       Balanced Accuracy : 0.6990          
##                                           
##        &#39;Positive&#39; Class : 1               
## </code></pre>
<p>Plugging this tree into a confusion matrix yields an accuracy of over 68%! I think this variable is very good for predicting mask wearing compliance. Thank you social scientists!</p>
</div>
</div>
<div id="credits" class="section level2">
<h2>Credits</h2>
<p>We thank the New York Times for the dataset.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
